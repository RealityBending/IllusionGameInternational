<!DOCTYPE html>
<html>
    <head>
        <!--create title shown in tab; not the same as header on webpage-->
        <title>Illusion Game</title>

        <script src="jspsych/jspsych.js"></script>

        <!--Load all necessary plugins stored in utils-->
        <script src="jspsych/plugin-html-keyboard-response.js"></script>
        <script src="jspsych/plugin-browser-check.js"></script>
        <script src="jspsych/plugin-html-button-response.js"></script>
        <script src="jspsych/plugin-fullscreen.js"></script>
        <script src="jspsych/plugin-survey-text.js"></script>
        <script src="jspsych/plugin-audio-button-response.js"></script>
        <script src="jspsych/plugin-canvas-button-response.js"></script>
        <script src="jspsych/plugin-preload.js"></script>
        <script src="jspsych/multiple-slider.js"></script>
        <script src="jspsych/extension-record-video.js"></script>
        <script src="jspsych/plugin-initialize-camera.js"></script>
        <script src="jspsych/plugin-survey-likert.js"></script>
        <script src="jspsych/plugin-image-keyboard-response.js"></script>
        <script src="jspsych/plugin-survey-multi-choice.js"></script>

        <!-- To save data via DataPipe (for online experiments) -->
        <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe@0.1"></script>

        <!-- Load parameters here (always below the loading of the JsPsych) -->
        <script src="demographics.js"></script>
        <script src="questionnaires.js"></script>

        <!-- Load stimuli data and IG stuff  -->
        <!-- <script src="stimuli/stimuli_training.js"></script>
        <script src="stimuli/stimuli_part1.js"></script>
        <script src="stimuli/stimuli_part2.js"></script>
        <script src="IllusionGame.js"></script> -->

        <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />
        <style>
            /* set canvas to be full screen */
            .jspsych-content {
                max-width: 100%;
            }

            /*Hide scrollbar while keeping it functional */
            body {
                overflow-y: scroll;
            }

            Body::-webkit-scrollbar {
                display: none;
            }
        </style>
    </head>

    <body></body>

    <script>
        /* ----------------- Initialize experiment ----------------- */
        var timeline = []

        var jsPsych = initJsPsych({
            on_finish: function () {
                // Display data in browse (useful for debugging)
                jsPsych.data.displayData("json")

                // Save data based on the participant_id variable
                jsPsych.data
                    .get()
                    .localSave(
                        "json",
                        `${
                            jsPsych.data.get().values()[0]["participant_id"]
                        }.json`
                    )
            },
        })

        // Enter fullscreen mode
        timeline.push({
            type: jsPsychFullscreen,
            fullscreen_mode: true,
            delay_after: 0,
        })

        /* ----------------- Session Info ----------------- */
        timeline.push(demographics_browser_info)
        timeline.push(demographics_participant_id)

        /* ============================================================== */
        /* --------------  ------Questionnaires -----------  ------------ */
        /* ============================================================== */
        // Adding some characters in russian to force correct encoding: Введите

        // // Questionnaires -----------------------------------------------------
        // var Qs = [ipip6_questionaire, pid5_questionaire]
        // Qs = jsPsych.randomization.shuffle(Qs) // Randomize
        // for (var i = 0; i < Qs.length; i++) {
        //     timeline.push(Qs[i]) // Push each element to timeline
        // }

        // End =================================================================
        // Exit fullscreen mode
        timeline.push({
            type: jsPsychFullscreen,
            fullscreen_mode: false,
        })

        // Save data
        timeline.push({
            type: jsPsychPipe,
            action: "save",
            experiment_id: "KnBMjNNnvXFM", // This in generated in the DataPipe interface
            filename: `${jsPsych.randomization.randomID(10)}.csv`,
            data_string: () => jsPsych.data.get().json(),
        })

        /* ----------------- Run the timeline ----------------- */
        jsPsych.run(timeline)
    </script>
</html>
